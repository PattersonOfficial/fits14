!function(){"use strict";var b={cipher:{},hash:{},keyexchange:{},mode:{},misc:{},codec:{},exception:{corrupt:function(t){this.toString=function(){return"CORRUPT: "+this.message},this.message=t},invalid:function(t){this.toString=function(){return"INVALID: "+this.message},this.message=t},bug:function(t){this.toString=function(){return"BUG: "+this.message},this.message=t},notReady:function(t){this.toString=function(){return"NOT READY: "+this.message},this.message=t}}};function t(){this.i=0,this.j=0,this.S=new Array}"undefined"!=typeof module&&module.exports&&(module.exports=b),b.cipher.aes=function(t){this._tables[0][0][0]||this._precompute();var e,r,i,n,o,s=this._tables[0][4],a=this._tables[1],h=t.length,c=1;if(4!==h&&6!==h&&8!==h)throw new b.exception.invalid("invalid aes key size");for(this._key=[n=t.slice(0),o=[]],e=h;e<4*h+28;e++)i=n[e-1],(e%h==0||8===h&&e%h==4)&&(i=s[i>>>24]<<24^s[i>>16&255]<<16^s[i>>8&255]<<8^s[255&i],e%h==0&&(i=i<<8^i>>>24^c<<24,c=c<<1^283*(c>>7))),n[e]=n[e-h]^i;for(r=0;e;r++,e--)i=n[3&r?e:e-4],o[r]=e<=4||r<4?i:a[0][s[i>>>24]]^a[1][s[i>>16&255]]^a[2][s[i>>8&255]]^a[3][s[255&i]]},b.cipher.aes.prototype={encrypt:function(t){return this._crypt(t,0)},decrypt:function(t){return this._crypt(t,1)},_tables:[[[],[],[],[],[]],[[],[],[],[],[]]],_precompute:function(){var t,e,r,i,n,o,s,a,h=this._tables[0],c=this._tables[1],u=h[4],l=c[4],p=[],f=[];for(t=0;t<256;t++)f[(p[t]=t<<1^283*(t>>7))^t]=t;for(e=r=0;!u[e];e^=i||1,r=f[r]||1)for(o=(o=r^r<<1^r<<2^r<<3^r<<4)>>8^255&o^99,a=16843009*p[n=p[i=p[l[u[e]=o]=e]]]^65537*n^257*i^16843008*e,s=257*p[o]^16843008*o,t=0;t<4;t++)h[t][e]=s=s<<24^s>>>8,c[t][o]=a=a<<24^a>>>8;for(t=0;t<5;t++)h[t]=h[t].slice(0),c[t]=c[t].slice(0)},_crypt:function(t,e){if(4!==t.length)throw new b.exception.invalid("invalid aes block size");var r,i,n,o,s=this._key[e],a=t[0]^s[0],h=t[e?3:1]^s[1],c=t[2]^s[2],u=t[e?1:3]^s[3],l=s.length/4-2,p=4,f=[0,0,0,0],d=this._tables[e],y=d[0],m=d[1],v=d[2],g=d[3],_=d[4];for(o=0;o<l;o++)r=y[a>>>24]^m[h>>16&255]^v[c>>8&255]^g[255&u]^s[p],i=y[h>>>24]^m[c>>16&255]^v[u>>8&255]^g[255&a]^s[p+1],n=y[c>>>24]^m[u>>16&255]^v[a>>8&255]^g[255&h]^s[p+2],u=y[u>>>24]^m[a>>16&255]^v[h>>8&255]^g[255&c]^s[p+3],p+=4,a=r,h=i,c=n;for(o=0;o<4;o++)f[e?3&-o:o]=_[a>>>24]<<24^_[h>>16&255]<<16^_[c>>8&255]<<8^_[255&u]^s[p++],r=a,a=h,h=c,c=u,u=r;return f}},b.bitArray={bitSlice:function(t,e,r){return t=b.bitArray._shiftRight(t.slice(e/32),32-(31&e)).slice(1),void 0===r?t:b.bitArray.clamp(t,r-e)},extract:function(t,e,r){var i=Math.floor(-e-r&31);return(-32&(e+r-1^e)?t[e/32|0]<<32-i^t[e/32+1|0]>>>i:t[e/32|0]>>>i)&(1<<r)-1},concat:function(t,e){if(0===t.length||0===e.length)return t.concat(e);var r=t[t.length-1],i=b.bitArray.getPartial(r);return 32===i?t.concat(e):b.bitArray._shiftRight(e,i,0|r,t.slice(0,t.length-1))},bitLength:function(t){var e,r=t.length;return 0===r?0:(e=t[r-1],32*(r-1)+b.bitArray.getPartial(e))},clamp:function(t,e){if(32*t.length<e)return t;var r=(t=t.slice(0,Math.ceil(e/32))).length;return e&=31,0<r&&e&&(t[r-1]=b.bitArray.partial(e,t[r-1]&2147483648>>e-1,1)),t},partial:function(t,e,r){return 32===t?e:(r?0|e:e<<32-t)+1099511627776*t},getPartial:function(t){return Math.round(t/1099511627776)||32},equal:function(t,e){if(b.bitArray.bitLength(t)!==b.bitArray.bitLength(e))return!1;var r,i=0;for(r=0;r<t.length;r++)i|=t[r]^e[r];return 0===i},_shiftRight:function(t,e,r,i){var n,o,s;for(void 0===i&&(i=[]);32<=e;e-=32)i.push(r),r=0;if(0===e)return i.concat(t);for(n=0;n<t.length;n++)i.push(r|t[n]>>>e),r=t[n]<<32-e;return o=t.length?t[t.length-1]:0,s=b.bitArray.getPartial(o),i.push(b.bitArray.partial(e+s&31,32<e+s?r:i.pop(),1)),i},_xor4:function(t,e){return[t[0]^e[0],t[1]^e[1],t[2]^e[2],t[3]^e[3]]}},b.codec.hex={fromBits:function(t){var e,r="";for(e=0;e<t.length;e++)r+=(0xf00000000000+(0|t[e])).toString(16).substr(4);return r.substr(0,b.bitArray.bitLength(t)/4)},toBits:function(t){var e,r,i=[];for(r=(t=t.replace(/\s|0x/g,"")).length,t+="00000000",e=0;e<t.length;e+=8)i.push(0^parseInt(t.substr(e,8),16));return b.bitArray.clamp(i,4*r)}},b.codec.utf8String={fromBits:function(t){var e,r,i="",n=b.bitArray.bitLength(t);for(e=0;e<n/8;e++)0==(3&e)&&(r=t[e/4]),i+=String.fromCharCode(r>>>24),r<<=8;return decodeURIComponent(escape(i))},toBits:function(t){t=unescape(encodeURIComponent(t));var e,r=[],i=0;for(e=0;e<t.length;e++)i=i<<8|t.charCodeAt(e),3==(3&e)&&(r.push(i),i=0);return 3&e&&r.push(b.bitArray.partial(8*(3&e),i)),r}},b.codec.base64={_chars:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",fromBits:function(t,e,r){var i,n="",o=0,s=b.codec.base64._chars,a=0,h=b.bitArray.bitLength(t);for(r&&(s=s.substr(0,62)+"-_"),i=0;6*n.length<h;)n+=s.charAt((a^t[i]>>>o)>>>26),o<6?(a=t[i]<<6-o,o+=26,i++):(a<<=6,o-=6);for(;3&n.length&&!e;)n+="=";return n},toBits:function(t,e){t=t.replace(/\s|=/g,"");var r,i,n=[],o=0,s=b.codec.base64._chars,a=0;for(e&&(s=s.substr(0,62)+"-_"),r=0;r<t.length;r++){if((i=s.indexOf(t.charAt(r)))<0)throw new b.exception.invalid("this isn't base64!");26<o?(o-=26,n.push(a^i>>>o),a=i<<32-o):a^=i<<32-(o+=6)}return 56&o&&n.push(b.bitArray.partial(56&o,a,1)),n}},b.codec.base64url={fromBits:function(t){return b.codec.base64.fromBits(t,1,1)},toBits:function(t){return b.codec.base64.toBits(t,1)}},void 0===b.beware&&(b.beware={}),b.beware["CBC mode is dangerous because it doesn't protect message integrity."]=function(){b.mode.cbc={name:"cbc",encrypt:function(t,e,r,i){if(i&&i.length)throw new b.exception.invalid("cbc can't authenticate data");if(128!==b.bitArray.bitLength(r))throw new b.exception.invalid("cbc iv must be 128 bits");var n,o=b.bitArray,s=o._xor4,a=o.bitLength(e),h=0,c=[];if(7&a)throw new b.exception.invalid("pkcs#5 padding only works for multiples of a byte");for(n=0;h+128<=a;n+=4,h+=128)r=t.encrypt(s(r,e.slice(n,n+4))),c.splice(n,0,r[0],r[1],r[2],r[3]);return a=16843009*(16-(a>>3&15)),r=t.encrypt(s(r,o.concat(e,[a,a,a,a]).slice(n,n+4))),c.splice(n,0,r[0],r[1],r[2],r[3]),c},decrypt:function(t,e,r,i){if(i&&i.length)throw new b.exception.invalid("cbc can't authenticate data");if(128!==b.bitArray.bitLength(r))throw new b.exception.invalid("cbc iv must be 128 bits");if(127&b.bitArray.bitLength(e)||!e.length)throw new b.exception.corrupt("cbc ciphertext must be a positive multiple of the block size");var n,o,s,a=b.bitArray,h=a._xor4,c=[];for(i=i||[],n=0;n<e.length;n+=4)o=e.slice(n,n+4),s=h(r,t.decrypt(o)),c.splice(n,0,s[0],s[1],s[2],s[3]),r=o;if(0==(o=255&c[n-1])||16<o)throw new b.exception.corrupt("pkcs#5 padding corrupt");if(s=16843009*o,!a.equal(a.bitSlice([s,s,s,s],0,8*o),a.bitSlice(c,32*c.length-8*o,32*c.length)))throw new b.exception.corrupt("pkcs#5 padding corrupt");return a.bitSlice(c,0,32*c.length-8*o)}}},b.misc.hmac=function(t,e){this._hash=e=e||b.hash.sha256;var r,i=[[],[]],n=e.prototype.blockSize/32;for(this._baseHash=[new e,new e],t.length>n&&(t=e.hash(t)),r=0;r<n;r++)i[0][r]=909522486^t[r],i[1][r]=1549556828^t[r];this._baseHash[0].update(i[0]),this._baseHash[1].update(i[1])},b.misc.hmac.prototype.encrypt=b.misc.hmac.prototype.mac=function(t,e){var r=new this._hash(this._baseHash[0]).update(t,e).finalize();return new this._hash(this._baseHash[1]).update(r).finalize()},b.hash.sha256=function(t){this._key[0]||this._precompute(),t?(this._h=t._h.slice(0),this._buffer=t._buffer.slice(0),this._length=t._length):this.reset()},b.hash.sha256.hash=function(t){return(new b.hash.sha256).update(t).finalize()},b.hash.sha256.prototype={blockSize:512,reset:function(){return this._h=this._init.slice(0),this._buffer=[],this._length=0,this},update:function(t){"string"==typeof t&&(t=b.codec.utf8String.toBits(t));var e,r=this._buffer=b.bitArray.concat(this._buffer,t),i=this._length,n=this._length=i+b.bitArray.bitLength(t);for(e=512+i&-512;e<=n;e+=512)this._block(r.splice(0,16));return this},finalize:function(){var t,e=this._buffer,r=this._h;for(t=(e=b.bitArray.concat(e,[b.bitArray.partial(1,1)])).length+2;15&t;t++)e.push(0);for(e.push(Math.floor(this._length/4294967296)),e.push(0|this._length);e.length;)this._block(e.splice(0,16));return this.reset(),r},_init:[],_key:[],_precompute:function(){var t,e=0,r=2;function i(t){return 4294967296*(t-Math.floor(t))|0}t:for(;e<64;r++){for(t=2;t*t<=r;t++)if(r%t==0)continue t;e<8&&(this._init[e]=i(Math.pow(r,.5))),this._key[e]=i(Math.pow(r,1/3)),e++}},_block:function(t){var e,r,i,n,o=t.slice(0),s=this._h,a=this._key,h=s[0],c=s[1],u=s[2],l=s[3],p=s[4],f=s[5],d=s[6],y=s[7];for(e=0;e<64;e++)r=(r=e<16?o[e]:(i=o[e+1&15],n=o[e+14&15],o[15&e]=(i>>>7^i>>>18^i>>>3^i<<25^i<<14)+(n>>>17^n>>>19^n>>>10^n<<15^n<<13)+o[15&e]+o[e+9&15]|0))+y+(p>>>6^p>>>11^p>>>25^p<<26^p<<21^p<<7)+(d^p&(f^d))+a[e],y=d,d=f,f=p,p=l+r|0,l=u,u=c,h=r+((c=h)&u^l&(c^u))+(c>>>2^c>>>13^c>>>22^c<<30^c<<19^c<<10)|0;s[0]=s[0]+h|0,s[1]=s[1]+c|0,s[2]=s[2]+u|0,s[3]=s[3]+l|0,s[4]=s[4]+p|0,s[5]=s[5]+f|0,s[6]=s[6]+d|0,s[7]=s[7]+y|0}},b.random={randomWords:function(t,e){var r,i,n=[],o=this.isReady(e);if(o===this._NOT_READY)throw new b.exception.notReady("generator isn't seeded");for(o&this._REQUIRES_RESEED&&this._reseedFromPools(!(o&this._READY)),r=0;r<t;r+=4)(r+1)%this._MAX_WORDS_PER_BURST==0&&this._gate(),i=this._gen4words(),n.push(i[0],i[1],i[2],i[3]);return this._gate(),n.slice(0,t)},setDefaultParanoia:function(t){this._defaultParanoia=t},addEntropy:function(t,e,r){r=r||"user";var i,n,o,s=(new Date).valueOf(),a=this._robins[r],h=this.isReady(),c=0;switch(void 0===(i=this._collectorIds[r])&&(i=this._collectorIds[r]=this._collectorIdNext++),void 0===a&&(a=this._robins[r]=0),this._robins[r]=(this._robins[r]+1)%this._pools.length,typeof t){case"number":void 0===e&&(e=1),this._pools[a].update([i,this._eventId++,1,e,s,1,0|t]);break;case"object":var u=Object.prototype.toString.call(t);if("[object Uint32Array]"===u){for(o=[],n=0;n<t.length;n++)o.push(t[n]);t=o}else for("[object Array]"!==u&&(c=1),n=0;n<t.length&&!c;n++)"number"!=typeof t[n]&&(c=1);if(!c){if(void 0===e)for(n=e=0;n<t.length;n++)for(o=t[n];0<o;)e++,o>>>=1;this._pools[a].update([i,this._eventId++,2,e,s,t.length].concat(t))}break;case"string":void 0===e&&(e=t.length),this._pools[a].update([i,this._eventId++,3,e,s,t.length]),this._pools[a].update(t);break;default:c=1}if(c)throw new b.exception.bug("random: addEntropy only supports number, array of numbers or string");this._poolEntropy[a]+=e,this._poolStrength+=e,h===this._NOT_READY&&(this.isReady()!==this._NOT_READY&&this._fireEvent("seeded",Math.max(this._strength,this._poolStrength)),this._fireEvent("progress",this.getProgress()))},isReady:function(t){var e=this._PARANOIA_LEVELS[void 0!==t?t:this._defaultParanoia];return this._strength&&this._strength>=e?this._poolEntropy[0]>this._BITS_PER_RESEED&&(new Date).valueOf()>this._nextReseed?this._REQUIRES_RESEED|this._READY:this._READY:this._poolStrength>=e?this._REQUIRES_RESEED|this._NOT_READY:this._NOT_READY},getProgress:function(t){var e=this._PARANOIA_LEVELS[t||this._defaultParanoia];return this._strength>=e?1:this._poolStrength>e?1:this._poolStrength/e},startCollectors:function(){if(!this._collectorsStarted){if(window.addEventListener)window.addEventListener("load",this._loadTimeCollector,!1),window.addEventListener("mousemove",this._mouseCollector,!1);else{if(!document.attachEvent)throw new b.exception.bug("can't attach event");document.attachEvent("onload",this._loadTimeCollector),document.attachEvent("onmousemove",this._mouseCollector)}this._collectorsStarted=!0}},stopCollectors:function(){this._collectorsStarted&&(window.removeEventListener?(window.removeEventListener("load",this._loadTimeCollector,!1),window.removeEventListener("mousemove",this._mouseCollector,!1)):window.detachEvent&&(window.detachEvent("onload",this._loadTimeCollector),window.detachEvent("onmousemove",this._mouseCollector)),this._collectorsStarted=!1)},addEventListener:function(t,e){this._callbacks[t][this._callbackI++]=e},removeEventListener:function(t,e){var r,i,n=this._callbacks[t],o=[];for(i in n)n.hasOwnProperty(i)&&n[i]===e&&o.push(i);for(r=0;r<o.length;r++)delete n[i=o[r]]},_pools:[new b.hash.sha256],_poolEntropy:[0],_reseedCount:0,_robins:{},_eventId:0,_collectorIds:{},_collectorIdNext:0,_strength:0,_poolStrength:0,_nextReseed:0,_key:[0,0,0,0,0,0,0,0],_counter:[0,0,0,0],_cipher:void 0,_defaultParanoia:6,_collectorsStarted:!1,_callbacks:{progress:{},seeded:{}},_callbackI:0,_NOT_READY:0,_READY:1,_REQUIRES_RESEED:2,_MAX_WORDS_PER_BURST:65536,_PARANOIA_LEVELS:[0,48,64,96,128,192,256,384,512,768,1024],_MILLISECONDS_PER_RESEED:3e4,_BITS_PER_RESEED:80,_gen4words:function(){for(var t=0;t<4&&(this._counter[t]=this._counter[t]+1|0,!this._counter[t]);t++);return this._cipher.encrypt(this._counter)},_gate:function(){this._key=this._gen4words().concat(this._gen4words()),this._cipher=new b.cipher.aes(this._key)},_reseed:function(t){this._key=b.hash.sha256.hash(this._key.concat(t)),this._cipher=new b.cipher.aes(this._key);for(var e=0;e<4&&(this._counter[e]=this._counter[e]+1|0,!this._counter[e]);e++);},_reseedFromPools:function(t){var e,r=[],i=0;for(this._nextReseed=r[0]=(new Date).valueOf()+this._MILLISECONDS_PER_RESEED,e=0;e<16;e++)r.push(4294967296*Math.random()|0);for(e=0;e<this._pools.length&&(r=r.concat(this._pools[e].finalize()),i+=this._poolEntropy[e],this._poolEntropy[e]=0,t||!(this._reseedCount&1<<e));e++);this._reseedCount>=1<<this._pools.length&&(this._pools.push(new b.hash.sha256),this._poolEntropy.push(0)),this._poolStrength-=i,i>this._strength&&(this._strength=i),this._reseedCount++,this._reseed(r)},_mouseCollector:function(t){var e=t.x||t.clientX||t.offsetX||0,r=t.y||t.clientY||t.offsetY||0;b.random.addEntropy([e,r],2,"mouse")},_loadTimeCollector:function(t){b.random.addEntropy((new Date).valueOf(),2,"loadtime")},_fireEvent:function(t,e){var r,i=b.random._callbacks[t],n=[];for(r in i)i.hasOwnProperty(r)&&n.push(i[r]);for(r=0;r<n.length;r++)n[r](e)}},function(){try{var t=new Uint32Array(32);crypto.getRandomValues(t),b.random.addEntropy(t,1024,"crypto.getRandomValues")}catch(t){}}(),function(){for(var t in b.beware)b.beware.hasOwnProperty(t)&&b.beware[t]()}(),t.prototype.init=function(t){var e,r,i;for(e=0;e<256;++e)this.S[e]=e;for(e=r=0;e<256;++e)r=r+this.S[e]+t[e%t.length]&255,i=this.S[e],this.S[e]=this.S[r],this.S[r]=i;this.i=0,this.j=0},t.prototype.next=function(){var t;return this.i=this.i+1&255,this.j=this.j+this.S[this.i]&255,t=this.S[this.i],this.S[this.i]=this.S[this.j],this.S[this.j]=t,this.S[t+this.S[this.i]&255]};var e,r,i,n,o=256;function s(){!function(t){r[i++]^=255&t,r[i++]^=t>>8&255,r[i++]^=t>>16&255,r[i++]^=t>>24&255,o<=i&&(i-=o)}((new Date).getTime())}if(null==r){var a;if(r=new Array,i=0,window.crypto&&window.crypto.getRandomValues){var h=new Uint8Array(32);for(window.crypto.getRandomValues(h),a=0;a<32;++a)r[i++]=h[a]}if("Netscape"==navigator.appName&&navigator.appVersion<"5"&&window.crypto){var c=window.crypto.random(32);for(a=0;a<c.length;++a)r[i++]=255&c.charCodeAt(a)}for(;i<o;)a=Math.floor(65536*Math.random()),r[i++]=a>>>8,r[i++]=255&a;i=0,s()}function u(){if(null==e){for(s(),(e=new t).init(r),i=0;i<r.length;++i)r[i]=0;i=0}return e.next()}function l(){}l.prototype.nextBytes=function(t){var e;for(e=0;e<t.length;++e)t[e]=u()};function _(t,e,r){null!=t&&("number"==typeof t?this.fromNumber(t,e,r):null==e&&"string"!=typeof t?this.fromString(t,256):this.fromString(t,e))}function E(){return new _(null)}n="Microsoft Internet Explorer"==navigator.appName?(_.prototype.am=function(t,e,r,i,n,o){for(var s=32767&e,a=e>>15;0<=--o;){var h=32767&this[t],c=this[t++]>>15,u=a*h+c*s;n=((h=s*h+((32767&u)<<15)+r[i]+(1073741823&n))>>>30)+(u>>>15)+a*c+(n>>>30),r[i++]=1073741823&h}return n},30):"Netscape"!=navigator.appName?(_.prototype.am=function(t,e,r,i,n,o){for(;0<=--o;){var s=e*this[t++]+r[i]+n;n=Math.floor(s/67108864),r[i++]=67108863&s}return n},26):(_.prototype.am=function(t,e,r,i,n,o){for(var s=16383&e,a=e>>14;0<=--o;){var h=16383&this[t],c=this[t++]>>14,u=a*h+c*s;n=((h=s*h+((16383&u)<<14)+r[i]+n)>>28)+(u>>14)+a*c,r[i++]=268435455&h}return n},28),_.prototype.DB=n,_.prototype.DM=(1<<n)-1,_.prototype.DV=1<<n;_.prototype.FV=Math.pow(2,52),_.prototype.F1=52-n,_.prototype.F2=2*n-52;var p,f,d="0123456789abcdefghijklmnopqrstuvwxyz",y=new Array;for(p="0".charCodeAt(0),f=0;f<=9;++f)y[p++]=f;for(p="a".charCodeAt(0),f=10;f<36;++f)y[p++]=f;for(p="A".charCodeAt(0),f=10;f<36;++f)y[p++]=f;function m(t){return d.charAt(t)}function v(t){var e=E();return e.fromInt(t),e}function S(t){var e,r=1;return 0!=(e=t>>>16)&&(t=e,r+=16),0!=(e=t>>8)&&(t=e,r+=8),0!=(e=t>>4)&&(t=e,r+=4),0!=(e=t>>2)&&(t=e,r+=2),0!=(e=t>>1)&&(t=e,r+=1),r}function g(t){this.m=t}function A(t){this.m=t,this.mp=t.invDigit(),this.mpl=32767&this.mp,this.mph=this.mp>>15,this.um=(1<<t.DB-15)-1,this.mt2=2*t.t}g.prototype.convert=function(t){return t.s<0||0<=t.compareTo(this.m)?t.mod(this.m):t},g.prototype.revert=function(t){return t},g.prototype.reduce=function(t){t.divRemTo(this.m,null,t)},g.prototype.mulTo=function(t,e,r){t.multiplyTo(e,r),this.reduce(r)},g.prototype.sqrTo=function(t,e){t.squareTo(e),this.reduce(e)},A.prototype.convert=function(t){var e=E();return t.abs().dlShiftTo(this.m.t,e),e.divRemTo(this.m,null,e),t.s<0&&0<e.compareTo(_.ZERO)&&this.m.subTo(e,e),e},A.prototype.revert=function(t){var e=E();return t.copyTo(e),this.reduce(e),e},A.prototype.reduce=function(t){for(;t.t<=this.mt2;)t[t.t++]=0;for(var e=0;e<this.m.t;++e){var r=32767&t[e],i=r*this.mpl+((r*this.mph+(t[e]>>15)*this.mpl&this.um)<<15)&t.DM;for(t[r=e+this.m.t]+=this.m.am(0,i,t,e,0,this.m.t);t[r]>=t.DV;)t[r]-=t.DV,t[++r]++}t.clamp(),t.drShiftTo(this.m.t,t),0<=t.compareTo(this.m)&&t.subTo(this.m,t)},A.prototype.mulTo=function(t,e,r){t.multiplyTo(e,r),this.reduce(r)},A.prototype.sqrTo=function(t,e){t.squareTo(e),this.reduce(e)},_.prototype.copyTo=function(t){for(var e=this.t-1;0<=e;--e)t[e]=this[e];t.t=this.t,t.s=this.s},_.prototype.fromInt=function(t){this.t=1,this.s=t<0?-1:0,0<t?this[0]=t:t<-1?this[0]=t+this.DV:this.t=0},_.prototype.fromString=function(t,e){var r;if(16==e)r=4;else if(8==e)r=3;else if(256==e)r=8;else if(2==e)r=1;else if(32==e)r=5;else{if(4!=e)return void this.fromRadix(t,e);r=2}this.t=0,this.s=0;for(var i,n,o=t.length,s=!1,a=0;0<=--o;){var h=8==r?255&t[o]:(i=o,null==(n=y[t.charCodeAt(i)])?-1:n);h<0?"-"==t.charAt(o)&&(s=!0):(s=!1,0==a?this[this.t++]=h:a+r>this.DB?(this[this.t-1]|=(h&(1<<this.DB-a)-1)<<a,this[this.t++]=h>>this.DB-a):this[this.t-1]|=h<<a,(a+=r)>=this.DB&&(a-=this.DB))}8==r&&0!=(128&t[0])&&(this.s=-1,0<a&&(this[this.t-1]|=(1<<this.DB-a)-1<<a)),this.clamp(),s&&_.ZERO.subTo(this,this)},_.prototype.clamp=function(){for(var t=this.s&this.DM;0<this.t&&this[this.t-1]==t;)--this.t},_.prototype.dlShiftTo=function(t,e){var r;for(r=this.t-1;0<=r;--r)e[r+t]=this[r];for(r=t-1;0<=r;--r)e[r]=0;e.t=this.t+t,e.s=this.s},_.prototype.drShiftTo=function(t,e){for(var r=t;r<this.t;++r)e[r-t]=this[r];e.t=Math.max(this.t-t,0),e.s=this.s},_.prototype.lShiftTo=function(t,e){var r,i=t%this.DB,n=this.DB-i,o=(1<<n)-1,s=Math.floor(t/this.DB),a=this.s<<i&this.DM;for(r=this.t-1;0<=r;--r)e[r+s+1]=this[r]>>n|a,a=(this[r]&o)<<i;for(r=s-1;0<=r;--r)e[r]=0;e[s]=a,e.t=this.t+s+1,e.s=this.s,e.clamp()},_.prototype.rShiftTo=function(t,e){e.s=this.s;var r=Math.floor(t/this.DB);if(r>=this.t)e.t=0;else{var i=t%this.DB,n=this.DB-i,o=(1<<i)-1;e[0]=this[r]>>i;for(var s=r+1;s<this.t;++s)e[s-r-1]|=(this[s]&o)<<n,e[s-r]=this[s]>>i;0<i&&(e[this.t-r-1]|=(this.s&o)<<n),e.t=this.t-r,e.clamp()}},_.prototype.subTo=function(t,e){for(var r=0,i=0,n=Math.min(t.t,this.t);r<n;)i+=this[r]-t[r],e[r++]=i&this.DM,i>>=this.DB;if(t.t<this.t){for(i-=t.s;r<this.t;)i+=this[r],e[r++]=i&this.DM,i>>=this.DB;i+=this.s}else{for(i+=this.s;r<t.t;)i-=t[r],e[r++]=i&this.DM,i>>=this.DB;i-=t.s}e.s=i<0?-1:0,i<-1?e[r++]=this.DV+i:0<i&&(e[r++]=i),e.t=r,e.clamp()},_.prototype.multiplyTo=function(t,e){var r=this.abs(),i=t.abs(),n=r.t;for(e.t=n+i.t;0<=--n;)e[n]=0;for(n=0;n<i.t;++n)e[n+r.t]=r.am(0,i[n],e,n,0,r.t);e.s=0,e.clamp(),this.s!=t.s&&_.ZERO.subTo(e,e)},_.prototype.squareTo=function(t){for(var e=this.abs(),r=t.t=2*e.t;0<=--r;)t[r]=0;for(r=0;r<e.t-1;++r){var i=e.am(r,e[r],t,2*r,0,1);(t[r+e.t]+=e.am(r+1,2*e[r],t,2*r+1,i,e.t-r-1))>=e.DV&&(t[r+e.t]-=e.DV,t[r+e.t+1]=1)}0<t.t&&(t[t.t-1]+=e.am(r,e[r],t,2*r,0,1)),t.s=0,t.clamp()},_.prototype.divRemTo=function(t,e,r){var i=t.abs();if(!(i.t<=0)){var n=this.abs();if(n.t<i.t)return null!=e&&e.fromInt(0),void(null!=r&&this.copyTo(r));null==r&&(r=E());var o=E(),s=this.s,a=t.s,h=this.DB-S(i[i.t-1]);0<h?(i.lShiftTo(h,o),n.lShiftTo(h,r)):(i.copyTo(o),n.copyTo(r));var c=o.t,u=o[c-1];if(0!=u){var l=u*(1<<this.F1)+(1<c?o[c-2]>>this.F2:0),p=this.FV/l,f=(1<<this.F1)/l,d=1<<this.F2,y=r.t,m=y-c,v=null==e?E():e;for(o.dlShiftTo(m,v),0<=r.compareTo(v)&&(r[r.t++]=1,r.subTo(v,r)),_.ONE.dlShiftTo(c,v),v.subTo(o,o);o.t<c;)o[o.t++]=0;for(;0<=--m;){var g=r[--y]==u?this.DM:Math.floor(r[y]*p+(r[y-1]+d)*f);if((r[y]+=o.am(0,g,r,m,0,c))<g)for(o.dlShiftTo(m,v),r.subTo(v,r);r[y]<--g;)r.subTo(v,r)}null!=e&&(r.drShiftTo(c,e),s!=a&&_.ZERO.subTo(e,e)),r.t=c,r.clamp(),0<h&&r.rShiftTo(h,r),s<0&&_.ZERO.subTo(r,r)}}},_.prototype.invDigit=function(){if(this.t<1)return 0;var t=this[0];if(0==(1&t))return 0;var e=3&t;return 0<(e=(e=(e=(e=e*(2-(15&t)*e)&15)*(2-(255&t)*e)&255)*(2-((65535&t)*e&65535))&65535)*(2-t*e%this.DV)%this.DV)?this.DV-e:-e},_.prototype.isEven=function(){return 0==(0<this.t?1&this[0]:this.s)},_.prototype.exp=function(t,e){if(4294967295<t||t<1)return _.ONE;var r=E(),i=E(),n=e.convert(this),o=S(t)-1;for(n.copyTo(r);0<=--o;)if(e.sqrTo(r,i),0<(t&1<<o))e.mulTo(i,n,r);else{var s=r;r=i,i=s}return e.revert(r)},_.prototype.toString=function(t){if(this.s<0)return"-"+this.negate().toString(t);var e;if(16==t)e=4;else if(8==t)e=3;else if(2==t)e=1;else if(32==t)e=5;else{if(4!=t)return this.toRadix(t);e=2}var r,i=(1<<e)-1,n=!1,o="",s=this.t,a=this.DB-s*this.DB%e;if(0<s--)for(a<this.DB&&0<(r=this[s]>>a)&&(n=!0,o=m(r));0<=s;)a<e?(r=(this[s]&(1<<a)-1)<<e-a,r|=this[--s]>>(a+=this.DB-e)):(r=this[s]>>(a-=e)&i,a<=0&&(a+=this.DB,--s)),0<r&&(n=!0),n&&(o+=m(r));return n?o:"0"},_.prototype.negate=function(){var t=E();return _.ZERO.subTo(this,t),t},_.prototype.abs=function(){return this.s<0?this.negate():this},_.prototype.compareTo=function(t){var e=this.s-t.s;if(0!=e)return e;var r=this.t;if(0!=(e=r-t.t))return this.s<0?-e:e;for(;0<=--r;)if(0!=(e=this[r]-t[r]))return e;return 0},_.prototype.bitLength=function(){return this.t<=0?0:this.DB*(this.t-1)+S(this[this.t-1]^this.s&this.DM)},_.prototype.mod=function(t){var e=E();return this.abs().divRemTo(t,null,e),this.s<0&&0<e.compareTo(_.ZERO)&&t.subTo(e,e),e},_.prototype.modPowInt=function(t,e){var r;return r=t<256||e.isEven()?new g(e):new A(e),this.exp(t,r)},_.ZERO=v(0),_.ONE=v(1);var w="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",D="=";function C(t){var e,r,i="";for(e=0;e+3<=t.length;e+=3)r=parseInt(t.substring(e,e+3),16),i+=w.charAt(r>>6)+w.charAt(63&r);for(e+1==t.length?(r=parseInt(t.substring(e,e+1),16),i+=w.charAt(r<<2)):e+2==t.length&&(r=parseInt(t.substring(e,e+2),16),i+=w.charAt(r>>2)+w.charAt((3&r)<<4));0<(3&i.length);)i+=D;return i}function T(){this.n=null,this.e=0,this.d=null,this.p=null,this.q=null,this.dmp1=null,this.dmq1=null,this.coeff=null}function R(c){c=c;this.getBlueSnap=function(){return c},this.encrypt=function(t){if(!t)return"";var e=function(t){var e=t.split("$"),r=e[0],i=e[1],n=new T;return n.setPublic(i,r),n}(c.getPublicKey()),r={key:b.random.randomWords(8,0),encrypt:function(t){return this.encryptWithIv(t,b.random.randomWords(4,0))},encryptWithIv:function(t,e){var r,i,n,o;return r=new b.cipher.aes(this.key),o=b.codec.utf8String.toBits(t),n=b.mode.cbc.encrypt(r,o,e),i=b.bitArray.concat(e,n),b.codec.base64.fromBits(i)}},i=r.encrypt(t),n={key:b.random.randomWords(8,0),sign:function(t){var e;return e=new b.misc.hmac(this.key,b.hash.sha256).encrypt(t),b.codec.base64.fromBits(e)}},o=n.sign(b.codec.base64.toBits(i)),s=b.bitArray.concat(r.key,n.key),a=b.codec.base64.fromBits(s),h=e.encrypt_b64(a);return["$bsjs_"+c.getVersion().replace(/\./g,"_"),h,i,o].join("$")}}function I(h){h=h;var c=[],u=function(t){for(var e=[],r=t.children,i=0;i<r.length;i++){var n=r[i];if(1===n.nodeType&&n.attributes["data-bluesnap"]){var o=n.attributes["data-bluesnap"].nodeValue;"encryptedCreditCard"!==o&&"encryptedCvv"!==o||e.push(n)}else null!=n.children&&0<n.children.length&&(e=e.concat(u(n)))}return e};this.extractForm=function(t){return window.jQuery&&t instanceof jQuery?t[0]:t.nodeType&&1===t.nodeType?t:document.getElementById(t)},this.encryptForm=function(i){for(var t=u(i);0<c.length;){try{i.removeChild(c[0])}catch(t){}c.splice(0,1)}function e(t,e){var r=function(t,e){var r=document.createElement(t);for(var i in e)if(e.hasOwnProperty(i)){var n=e[i];r.setAttribute(i,n)}return r}("input",{value:t,type:"hidden",name:e});c.push(r),n.push(i.appendChild(r))}for(var n=[],r=0;r<t.length;r++){var o=t[r],s=o.getAttribute("data-bluesnap");if(7<o.value.length)e(o.value.substr(o.value.length-4),"ccLast4Digits");var a=h.encrypt(o.value);o.removeAttribute("name"),e(a,s)}return n}}T.prototype.doPublic=function(t){return t.modPowInt(this.e,this.n)},T.prototype.setPublic=function(t,e){null!=t&&null!=e&&0<t.length&&0<e.length?(this.n=function(t,e){return new _(t,e)}(t,16),this.e=parseInt(e,16)):alert("Invalid RSA public key")},T.prototype.encrypt=function(t){var e=function(t,e){if(e<t.length+11)return alert("Message too long for RSA"),null;for(var r=new Array,i=t.length-1;0<=i&&0<e;){var n=t.charCodeAt(i--);n<128?r[--e]=n:127<n&&n<2048?(r[--e]=63&n|128,r[--e]=n>>6|192):(r[--e]=63&n|128,r[--e]=n>>6&63|128,r[--e]=n>>12|224)}r[--e]=0;for(var o=new l,s=new Array;2<e;){for(s[0]=0;0==s[0];)o.nextBytes(s);r[--e]=s[0]}return r[--e]=2,r[--e]=0,new _(r)}(t,this.n.bitLength()+7>>3);if(null==e)return null;var r=this.doPublic(e);if(null==r)return null;var i=r.toString(16);return 0==(1&i.length)?i:"0"+i},T.prototype.encrypt_b64=function(t){var e;return(e=this.encrypt(t))?C(e):null};var N={},x=!(T.prototype.encrypt_b64=function(t){var e;return(e=this.encrypt(t))?C(e):null});function B(t,e){return{errorCode:t,errorDescription:e}}var k={"3DS_AUTHENTICATION_FAILED":B("14101","3D Secure authentication was failed because the shopper did not enter correct credentials"),"3DS_MISSING_REQUIRED_FIELDS":B("14102","3D Secure object is missing required fields")};function L(){var t=N.submitButton;null!=t&&(F("Enabling the submitButton"),t.disabled=!1)}var O=function(){var n=new M,h=new M;function o(t){!0===x&&console.log("bluesnap.3ds: "+t)}Cardinal.on("payments.setupComplete",function(){o("payments.setupComplete callback was called"),L(),n.getCallback()()}),Cardinal.on("payments.validated",function(t,e){var r;switch(o("payments.validated callback was called"),o(JSON.stringify(t)),null==e&&L(),t.ActionCode){case"SUCCESS":r="AUTHENTICATION_SUCCEEDED";break;case"NOACTION":r="AUTHENTICATION_UNAVAILABLE";try{"B"===t.Payment.ExtendedData.Enrolled&&(r="AUTHENTICATION_BYPASSED")}catch(t){o("Failed to parse data object. Error: "+t)}break;case"FAILURE":return r="AUTHENTICATION_FAILURE",void h.setError(k["3DS_AUTHENTICATION_FAILED"]);case"ERROR":10001!==t.ErrorNumber&&10002!==t.ErrorNumber&&10003!==t.ErrorNumber||o("Cardinal Cruise is unable to contact the Cardinal servers"),r="AUTHENTICATION_UNAVAILABLE"}if("AUTHENTICATION_FAILURE"!==r){var i={},n={};n.authResult=r,n.threeDSecureResultToken=e,i.threeDSecure=n,h.setResult(i)}}),O.prototype.init=function(t,e){o("threeDSecure.init() was called"),n.setCallback(e);var r=N.submitButton;null!=r&&(o("Disabling the submitButton until 3DS setup is completed"),r.disabled=!0);var i=!1===x?"off":"on";Cardinal.configure({logging:{level:i}}),o("Calling Cardinal.setup"),Cardinal.setup("init",{jwt:t})},O.prototype.process=function(t,e){if(o("threeDSecure.process() was called"),h.setCallback(e),null==t){o("threeDSecureObj = "+t);var r=k["3DS_MISSING_REQUIRED_FIELDS"];r.errorDescription+=" { amount, currency }",h.setError(r)}var i=function(t){var e=null!=N.encryptedCreditCard?N.encryptedCreditCard.value:null;null!=e&&(e=e.replace(/\s/g,""));var r,i=null!=N.expirationMonth?N.expirationMonth.value:null,n=null!=N.expirationYear?N.expirationYear.value:null;if(!1===function(t,e,r,i){var n=i.amount,o=i.currency,s="";null==t&&(s+="creditCard,");null==e&&(s+="expirationMonth,");null==r&&(s+="expirationYear,");null==n&&(s+="amount,");null==o&&(s+="currency,");if(""===s)return!0;s=s.substring(0,s.length-1);var a=k["3DS_MISSING_REQUIRED_FIELDS"];return a.errorDescription+=" { "+s+" }",h.setError(a),!1}(e,i,n,t))return;try{r={Consumer:{Account:{AccountNumber:e,ExpirationMonth:i,ExpirationYear:n}},OrderDetails:{Amount:t.amount,CurrencyCode:t.currency}},t.email&&(r.Consumer.Email1=t.email);var o,s={};t.billingFirstName&&(o.FirstName=t.billingFirstName),t.billingLastName&&(o.LastName=t.billingLastName),t.billingCountry&&(o.CountryCode=t.billingCountry),t.billingState&&(o.State=t.billingState),t.billingCity&&(o.City=t.billingCity),t.billingAddress&&(o.Address1=t.billingAddress),t.billingZip&&(o.Postalcode=t.billingZip),t.phone&&(o.Phone1=t.phone),t.shippingFirstName&&(s.FirstName=t.shippingFirstName),t.shippingLastName&&(s.LastName=t.shippingLastName),t.shippingCountry&&(s.CountryCode=t.shippingCountry),t.shippingState&&(s.State=t.shippingState),t.shippingCity&&(s.City=t.shippingCity),t.shippingAddress&&(s.Address1=t.shippingAddress),t.shippingZip&&(s.Postalcode=t.shippingZip),0===Object.keys(o).length&&o.constructor===Object||(r.Consumer.BillingAddress=o),0===Object.keys(s).length&&s.constructor===Object||(r.Consumer.ShippingAddress=s)}catch(t){}return r}(t);null!=i&&(o("Calling Cardinal.start"),Cardinal.start("cca",i))}},M=function(){var e=null;M.prototype.getCallback=function(){return e},M.prototype.setCallback=function(t){e=t},M.prototype.setResult=function(t){e(t,null)},M.prototype.setError=function(t){e(null,t)}};function P(t,e){!(this.isSandbox=!1)!==e&&"true"!==e||(this.isSandbox=!0);for(var r=document.querySelectorAll("[data-bluesnap]"),i=0;i<r.length;i++){var n=r[i],o=n.getAttribute("data-bluesnap");N[o]=n}t=t;var s=new I(new R(this));P.prototype.encrypt=function(t,e,r){if("string"==typeof t){var i=s.extractForm(t);if(F("Calling encryptForm"),s.encryptForm(i),null!=this.threeDSecure){if("function"!=typeof r)return void console.log("callback is not a function!");this.threeDSecure.process(e,function(t,e){null==e&&(t.encryptedCardNumber=document.querySelector("input[name='encryptedCreditCard']").value,t.encryptedSecurityCode=document.querySelector("input[name='encryptedCvv']").value,t.ccLast4Digits=document.querySelector("input[name='ccLast4Digits']").value,t.expirationYear=N.expirationYear.value,t.expirationMonth=N.expirationMonth.value),r(t,e)})}}else console.log("Expecting formId to be a string")},this.getPublicKey=function(){return t},this.getVersion=function(){return"1.0.4"}}function F(t){!0===x&&console.log("bluesnap: "+t)}P.prototype.init3DS=function(e,r){if(null==e||""===e){var t=k["3DS_MISSING_REQUIRED_FIELDS"];return t.errorDescription+=" { threeDSecureToken }",void r(null,t)}var i=document.querySelector("input[data-bluesnap='encryptedCreditCard']");i&&i.setAttribute("data-cardinal-field","AccountNumber");var n="https://includes.ccdc02.com/cardinalcruise/v1/songbird.js";!0===this.isSandbox&&(n="https://includestest.ccdc02.com/cardinalcruise/v1/songbird.js"),function(e,t){try{var r=document.createElement("script");r.type="text/javascript",r.src=e,r.onreadystatechange=t,r.onload=t,document.head.appendChild(r)}catch(t){F("Failed to load: "+e+". Error: "+t)}}(n,function(){var t=new O;bluesnap.setThreeDSecure(t),t.init(e,function(){r(null,null)})})},P.prototype.setThreeDSecure=function(t){this.threeDSecure=t},b.random.startCollectors(),window.BlueSnap=P}();
